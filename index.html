<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FitCheck Pro | Coach Suite</title>
    
    <meta name="theme-color" content="#020617">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://ui-avatars.com/api/?name=FC&background=6366f1&color=fff&size=180&bold=true">
    
    <script src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
          --sat: env(safe-area-inset-top); 
          --sar: env(safe-area-inset-right); 
          --sab: env(safe-area-inset-bottom); 
          --sal: env(safe-area-inset-left); 
        }
        body { 
          font-family: 'Inter', sans-serif; 
          -webkit-tap-highlight-color: transparent; 
          overscroll-behavior-y: contain; 
          margin: 0; 
          user-select: none; 
          overflow: hidden;
          transition: background-color 0.3s ease, color 0.3s ease;
        }
        #root { 
          height: 100vh; 
          width: 100vw; 
          overflow: hidden; 
          display: flex; 
          flex-direction: column; 
        }
        /* Robust padding for iPad/iPhone status bar overlap */
        .mobile-header-pad {
          padding-top: calc(var(--sat) + 40px);
          padding-bottom: 20px;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.4); border-radius: 10px; }
        
        button { cursor: pointer; }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-950 text-white">
    <div id="root"></div>

    <script>
        const e = React.createElement;
        const { useState, useEffect, useRef, useMemo } = React;

        const translations = {
          en: {
            langName: "English", traineeLabel: "Trainee",
            dash: "Dashboard", att: "Attendance", manage: "Trainees", logs: "Records",
            welcome: "Welcome, Coach", total: "Total Students", today: "Today's Lessons",
            search: "Search students...", checkIn: "Check-In", add: "New Student",
            lessons: "Lesson Total", sign: "Confirm Signature", reset: "Reset", cancel: "Cancel",
            verify: "Verification Signature", del: "Delete", confirmDel: "Erase student data?",
            lang: "Language", theme: "Theme", cycle: "Cycle", renew: "New Cycle",
            pkgInfo: "Progress", totalSessions: "Lesson Total", cycleNum: "Cycle",
            save: "Start Cycle", active: "Active", date: "Date", progress: "Progress",
            history: "History", noHistory: "No history", delLog: "Delete this record and restore 1 lesson?",
            searchLogs: "Search records by trainee name...", done: "Done"
          },
          zh_cn: {
            langName: "简体中文", traineeLabel: "学员姓名",
            dash: "仪表盘", att: "签到", manage: "学员", logs: "记录",
            welcome: "欢迎回来，教练", total: "学员总数", today: "今日已签",
            search: "搜索姓名...", checkIn: "签到核销", add: "添加学员",
            lessons: "购买课时", sign: "确认签名", reset: "重置", cancel: "取消",
            verify: "身份核验", del: "删除", confirmDel: "确定删除学员？",
            lang: "语言切换", theme: "主题", cycle: "期数", renew: "开启新期",
            pkgInfo: "课时进度", totalSessions: "总课时数", cycleNum: "期数",
            save: "开启新期", active: "活跃", date: "日期", progress: "进度",
            history: "历史记录", noHistory: "暂无历史", delLog: "删除此记录并恢复1课时？",
            searchLogs: "通过姓名搜索历史记录...", done: "完成"
          },
          zh_tw: {
            langName: "繁體中文", traineeLabel: "學員姓名",
            dash: "儀表盤", att: "簽到", manage: "學員", logs: "記錄",
            welcome: "歡迎回來，教練", total: "學員總數", today: "今日已簽",
            search: "搜索姓名...", checkIn: "簽到核銷", add: "添加學員",
            lessons: "購買課時", sign: "確認簽名", reset: "重置", cancel: "取消",
            verify: "身份核驗", del: "刪除", confirmDel: "確定刪除學員？",
            lang: "語言切換", theme: "主題", cycle: "期數", renew: "開啟新期",
            pkgInfo: "課時進度", totalSessions: "總課時數", cycleNum: "期數",
            save: "開啟新期", active: "活躍", date: "日期", progress: "進度",
            history: "歷史記錄", noHistory: "暫無歷史", delLog: "刪除此記錄並恢復1課時？",
            searchLogs: "通過姓名搜索歷史記錄...", done: "完成"
          },
          es: {
            langName: "Español", traineeLabel: "Alumno",
            dash: "Panel", att: "Asistencia", manage: "Alumnos", logs: "Registros",
            welcome: "Bienvenido, Coach", total: "Total Alumnos", today: "Hoy",
            search: "Buscar...", checkIn: "Check-In", add: "Nuevo Alumno",
            lessons: "Total Lecciones", sign: "Firmar", reset: "Reiniciar", cancel: "Cancelar",
            verify: "Firma de Verificación", del: "Eliminar", confirmDel: "¿Borrar alumno?",
            lang: "Idioma", theme: "Tema", cycle: "Ciclo", renew: "Nuevo Ciclo",
            pkgInfo: "Progreso", totalSessions: "Total Lecciones", cycleNum: "Ciclo",
            save: "Empezar", active: "Activo", date: "Fecha", progress: "Progreso",
            history: "Historial", noHistory: "Sin historial", delLog: "¿Eliminar y restaurar saldo?",
            searchLogs: "Buscar registros por nombre...", done: "Listo"
          },
          fr: {
            langName: "Français", traineeLabel: "Élève",
            dash: "Tableau", att: "Présence", manage: "Élèves", logs: "Détails",
            welcome: "Bienvenue, Coach", total: "Total Élèves", today: "Aujourd'hui",
            search: "Rechercher...", checkIn: "Check-In", add: "Nouvel Élève",
            lessons: "Total Leçons", sign: "Confirmer", reset: "Reset", cancel: "Annuler",
            verify: "Signature", del: "Supprimer", confirmDel: "Supprimer l'élève ?",
            lang: "Langue", theme: "Thème", cycle: "Cycle", renew: "Nouveau Cycle",
            pkgInfo: "Progrès", totalSessions: "Total Leçons", cycleNum: "Cycle",
            save: "Démarrer", active: "Actif", date: "Date", progress: "Progrès",
            history: "Historique", noHistory: "Aucun historique", delLog: "Supprimer et restaurer ?",
            searchLogs: "Chercher des records par nom...", done: "Terminé"
          },
          de: {
            langName: "Deutsch", traineeLabel: "Schüler",
            dash: "Dashboard", att: "Anwesenheit", manage: "Schüler", logs: "Protokoll",
            welcome: "Willkommen, Coach", total: "Gesamt Schüler", today: "Heute",
            search: "Suchen...", checkIn: "Check-In", add: "Neuer Schüler",
            lessons: "Lektionen Gesamt", sign: "Unterschreiben", reset: "Reset", cancel: "Abbrechen",
            verify: "Verifizierung", del: "Löschen", confirmDel: "Schüler löschen?",
            lang: "Sprache", theme: "Design", cycle: "Zyklus", renew: "Neuer Zyklus",
            pkgInfo: "Fortschritt", totalSessions: "Lektionen Gesamt", cycleNum: "Zyklus",
            save: "Starten", active: "Aktiv", date: "Datum", progress: "Fortschritt",
            history: "Historie", noHistory: "Keine Historie", delLog: "Löschen und wiederherstellen?",
            searchLogs: "Einträge nach Name suchen...", done: "Fertig"
          }
        };

        const db = {
          KEYS: { TR: 'fit_tr_v8', LG: 'fit_lg_v8', TM: 'fit_theme_v8', LN: 'fit_lang_v8' },
          get: (k) => JSON.parse(localStorage.getItem(k) || (k === db.KEYS.LN ? '"en"' : '[]')),
          set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
        };

        const Icon = ({ name, className }) => {
          const iconName = name.charAt(0).toLowerCase() + name.slice(1);
          const iconData = window.lucide.icons[iconName] || window.lucide.icons[name];
          if (!iconData) return e('span', { className });
          const [tag, attrs, children] = iconData;
          return e(tag, { ...attrs, className: className || 'w-6 h-6', stroke: 'currentColor', key: name }, 
            children.map((child, i) => e(child[0], { ...child[1], key: i }))
          );
        };

        const SignaturePad = ({ onSave, onCancel, t, theme }) => {
          const canvasRef = useRef(null);
          const [isDrawing, setIsDrawing] = useState(false);
          const isDark = theme === 'dark';

          useEffect(() => {
            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            ctx.lineWidth = 4; ctx.lineCap = 'round'; 
            ctx.strokeStyle = '#6366f1';
          }, []);

          const getPos = (ev) => {
            const rect = canvasRef.current.getBoundingClientRect();
            const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
            const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
          };

          const start = (ev) => {
            if (ev.cancelable) ev.preventDefault();
            const { x, y } = getPos(ev);
            const ctx = canvasRef.current.getContext('2d');
            ctx.beginPath(); ctx.moveTo(x, y);
            setIsDrawing(true);
          };

          const move = (ev) => {
            if (!isDrawing) return;
            if (ev.cancelable) ev.preventDefault();
            const { x, y } = getPos(ev);
            const ctx = canvasRef.current.getContext('2d');
            ctx.lineTo(x, y); ctx.stroke();
          };

          return e('div', { className: 'space-y-6' }, [
            e('div', { className: `relative h-72 border-2 rounded-[2.5rem] overflow-hidden ${isDark ? 'border-white/10 bg-black/40' : 'border-slate-200 bg-white shadow-inner'}` }, [
              e('canvas', {
                ref: canvasRef,
                onMouseDown: start, onMouseMove: move, onMouseUp: () => setIsDrawing(false),
                onTouchStart: start, onTouchMove: move, onTouchEnd: () => setIsDrawing(false),
                className: 'w-full h-full'
              }),
              e('div', { className: `absolute top-6 right-8 text-[9px] font-black uppercase tracking-widest ${isDark ? 'opacity-20' : 'opacity-40 text-slate-400'}` }, t.verify)
            ]),
            e('div', { className: 'flex gap-4' }, [
              e('button', { onClick: () => canvasRef.current.getContext('2d').clearRect(0,0,999,999), className: `flex-1 py-5 rounded-2xl font-bold text-[11px] uppercase ${isDark ? 'bg-white/5' : 'bg-slate-100 border border-slate-200'}` }, t.reset),
              e('button', { onClick: onCancel, className: `flex-1 py-5 rounded-2xl font-bold text-[11px] uppercase ${isDark ? 'bg-white/5' : 'bg-slate-100 border border-slate-200'}` }, t.cancel),
              e('button', { onClick: () => onSave(canvasRef.current.toDataURL()), className: 'flex-[2] py-5 bg-indigo-600 text-white rounded-2xl font-bold text-[11px] uppercase shadow-xl' }, t.sign)
            ])
          ]);
        };

        const App = () => {
          const [lang, setLang] = useState(() => db.get(db.KEYS.LN));
          const [theme, setTheme] = useState(() => localStorage.getItem(db.KEYS.TM) || 'dark');
          const [view, setView] = useState('dash');
          const [trainees, setTrainees] = useState(() => db.get(db.KEYS.TR));
          const [logs, setLogs] = useState(() => db.get(db.KEYS.LG));
          const [search, setSearch] = useState('');
          const [logSearch, setLogSearch] = useState('');
          
          const [activeUser, setActiveUser] = useState(null);
          const [isAdding, setIsAdding] = useState(false);
          const [renewing, setRenewing] = useState(null);
          const [showingHistory, setShowingHistory] = useState(null);
          const [isLangOpen, setIsLangOpen] = useState(false);

          const t = translations[lang];
          const isDark = theme === 'dark';

          useEffect(() => {
            document.body.className = isDark ? 'bg-slate-950 text-white' : 'bg-slate-50 text-slate-900';
            localStorage.setItem(db.KEYS.TM, theme);
          }, [theme]);

          useEffect(() => db.set(db.KEYS.LN, lang), [lang]);
          useEffect(() => db.set(db.KEYS.LG, logs), [logs]);
          useEffect(() => db.set(db.KEYS.TR, trainees), [trainees]);

          const filtered = useMemo(() => trainees.filter(tr => tr.name.toLowerCase().includes(search.toLowerCase())), [trainees, search]);
          const filteredLogs = useMemo(() => logs.filter(l => l.name.toLowerCase().includes(logSearch.toLowerCase())), [logs, logSearch]);

          // Fix Deletion logic to be extremely direct
          const deleteLog = (logId) => {
            if (!window.confirm(t.delLog)) return;
            
            const logToRemove = logs.find(l => l.id === logId);
            if (!logToRemove) return;

            // Remove the log from history
            setLogs(prev => prev.filter(l => l.id !== logId));

            // Restore the lesson balance for the student
            setTrainees(prev => prev.map(tr => {
              const isMatch = logToRemove.traineeId ? tr.id === logToRemove.traineeId : tr.name === logToRemove.name;
              // If it's the correct student and the record was for their CURRENT cycle, restore the count
              if (isMatch && tr.cycle === logToRemove.cycle) {
                return { ...tr, done: Math.max(0, tr.done - 1) };
              }
              return tr;
            }));
          };

          const NavBtn = (id, icon, label) => e('button', {
            onClick: () => setView(id),
            className: `flex items-center gap-4 px-6 py-5 rounded-2xl transition-all ${view === id 
              ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-600/30 scale-105' 
              : (isDark ? 'text-slate-500 hover:bg-white/5' : 'text-slate-400 hover:bg-slate-200/50')}`
          }, [
            e(Icon, { name: icon, className: 'w-5 h-5' }),
            e('span', { className: 'font-black uppercase text-[10px] tracking-widest' }, label)
          ]);

          const stats = useMemo(() => ({
            total: trainees.length,
            today: logs.filter(l => new Date(l.date).toDateString() === new Date().toDateString()).length,
            active: trainees.filter(tr => tr.done < tr.total).length
          }), [trainees, logs]);

          return e('div', { className: 'flex h-screen flex-col lg:flex-row overflow-hidden' }, [
            // Sidebar (Desktop)
            e('nav', { className: `hidden lg:flex w-80 flex-col gap-10 p-10 border-r ${isDark ? 'border-white/5' : 'border-slate-200 shadow-xl'}` }, [
              e('div', { className: 'flex items-center gap-4' }, [
                e('div', { className: 'p-3 bg-indigo-600 rounded-2xl shadow-lg shadow-indigo-500/20' }, e(Icon, { name: 'Activity', className: 'w-7 h-7 text-white' })),
                e('h1', { className: 'text-2xl font-black italic uppercase tracking-tighter' }, 'FitCheck')
              ]),
              e('div', { className: 'flex flex-col gap-2' }, [
                NavBtn('dash', 'LayoutDashboard', t.dash),
                NavBtn('att', 'CheckCircle2', t.att),
                NavBtn('manage', 'Users2', t.manage),
                NavBtn('logs', 'History', t.logs)
              ]),
              e('div', { className: 'mt-auto space-y-3' }, [
                e('button', { 
                  onClick: () => setTheme(isDark ? 'light' : 'dark'),
                  className: `w-full flex justify-between p-4 border rounded-xl text-[10px] font-black uppercase ${isDark ? 'border-white/5 bg-white/5' : 'border-slate-200 hover:bg-slate-100'}`
                }, [ e('span', {}, t.theme), e(Icon, { name: isDark ? 'Moon' : 'Sun', className: 'w-4 h-4' }) ]),
                e('button', { 
                  onClick: () => setIsLangOpen(true),
                  className: `w-full flex justify-between p-4 border rounded-xl text-[10px] font-black uppercase ${isDark ? 'border-white/5 bg-white/5' : 'border-slate-200 hover:bg-slate-100'}`
                }, [ e('span', {}, t.lang), e('span', {}, t.langName) ])
              ])
            ]),

            // Header (Mobile) - FIXED Overlap and Height
            e('header', { className: `lg:hidden mobile-header-pad flex justify-between items-center px-6 border-b z-50 sticky top-0 ${isDark ? 'bg-slate-950/95 border-white/5' : 'bg-white/95 border-slate-200'} backdrop-blur-xl shadow-lg` }, [
              e('h1', { className: 'font-black italic uppercase text-2xl tracking-tight' }, 'FitCheck'),
              e('div', { className: 'flex gap-1 items-center' }, [
                e('button', { onClick: () => setTheme(isDark ? 'light' : 'dark'), className: 'p-3 active:bg-slate-500/10 rounded-full transition-colors' }, e(Icon, { name: isDark ? 'Moon' : 'Sun', className: 'w-6 h-6 opacity-60' })),
                e('button', { onClick: () => setIsLangOpen(true), className: 'p-3 text-[11px] font-black uppercase tracking-widest opacity-80 active:bg-slate-500/10 rounded-xl' }, lang.toUpperCase())
              ])
            ]),

            // Main Content
            e('main', { className: 'flex-1 overflow-y-auto p-6 lg:p-14 pb-32' }, [
              e('div', { className: 'max-w-5xl mx-auto space-y-12 animate-fade-in' }, [
                
                view === 'dash' && e('div', { className: 'space-y-12' }, [
                  e('div', {}, [
                    e('h2', { className: 'text-5xl font-black mb-2' }, t.welcome),
                    e('p', { className: 'text-slate-500 font-medium' }, 'Studio metrics and studio progress.')
                  ]),
                  e('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' }, [
                    e('div', { className: `p-8 rounded-[3rem] border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('p', { className: 'text-[10px] font-black uppercase text-slate-500 tracking-widest' }, t.total),
                      e('p', { className: 'text-4xl font-black mt-3' }, stats.total)
                    ]),
                    e('div', { className: `p-8 rounded-[3rem] border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('p', { className: 'text-[10px] font-black uppercase text-slate-500 tracking-widest' }, t.today),
                      e('p', { className: 'text-4xl font-black mt-3 text-indigo-500' }, stats.today)
                    ]),
                    e('div', { className: `p-8 rounded-[3rem] border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('p', { className: 'text-[10px] font-black uppercase text-slate-500 tracking-widest' }, t.active),
                      e('p', { className: 'text-4xl font-black mt-3' }, stats.active)
                    ])
                  ])
                ]),

                view === 'att' && e('div', { className: 'space-y-8' }, [
                  e('div', { className: 'flex flex-col md:flex-row md:items-center justify-between gap-6' }, [
                    e('h2', { className: 'text-4xl font-black italic uppercase' }, t.att),
                    e('div', { className: 'relative flex-1 max-w-sm' }, [
                      e(Icon, { name: 'Search', className: 'absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 opacity-40' }),
                      e('input', { 
                        placeholder: t.search, 
                        onChange: (ev) => setSearch(ev.target.value), 
                        className: `w-full rounded-2xl pl-12 pr-6 py-4 text-sm outline-none border transition-all ${isDark ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200 shadow-sm focus:border-indigo-500'}` 
                      })
                    ])
                  ]),
                  e('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' }, filtered.map(tr => {
                    const progress = Math.min((tr.done / tr.total) * 100, 100);
                    const isCompleted = tr.done >= tr.total;
                    return e('div', { key: tr.id, className: `p-7 border rounded-[2.5rem] flex flex-col gap-5 ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm transition-all hover:scale-[1.01]'}` }, [
                      e('div', { className: 'flex justify-between items-start' }, [
                        e('div', {}, [
                          e('p', { className: 'font-black text-xl' }, tr.name),
                          e('div', { className: 'flex gap-3 items-center mt-2' }, [
                             e('span', { className: 'text-[10px] font-black text-indigo-500 uppercase px-3 py-1 bg-indigo-500/10 rounded-full' }, `${t.cycle} ${tr.cycle || 1}`),
                             e('span', { className: 'text-[10px] font-black text-slate-500 uppercase' }, `${tr.done} / ${tr.total}`)
                          ])
                        ]),
                        e('button', { 
                          onClick: () => setActiveUser(tr), 
                          disabled: isCompleted,
                          className: `w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transition-all active:scale-90 ${isCompleted ? 'opacity-20 bg-slate-500 cursor-not-allowed' : 'bg-indigo-600 text-white shadow-indigo-600/30'}` 
                        }, e(Icon, { name: 'Check', className: 'w-7 h-7' }))
                      ]),
                      e('div', { className: `w-full h-2 rounded-full overflow-hidden ${isDark ? 'bg-white/5' : 'bg-slate-100'}` }, [
                        e('div', { className: `h-full transition-all duration-700 ${isCompleted ? 'bg-emerald-500' : 'bg-indigo-500'}`, style: { width: `${progress}%` } })
                      ])
                    ]);
                  }))
                ]),

                view === 'manage' && e('div', { className: 'space-y-8' }, [
                  e('div', { className: 'flex justify-between items-center' }, [
                    e('h2', { className: 'text-4xl font-black italic uppercase' }, t.manage),
                    e('button', { onClick: () => setIsAdding(true), className: 'px-8 py-5 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase shadow-xl active:scale-95 shadow-indigo-600/20' }, t.add)
                  ]),
                  e('div', { className: 'space-y-4' }, trainees.map(tr => e('div', { key: tr.id, className: `p-8 border rounded-[3rem] flex flex-col gap-6 ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                    e('div', { className: 'flex flex-col md:flex-row md:items-center justify-between gap-4' }, [
                      e('div', { className: 'flex flex-col gap-1' }, [
                        e('p', { className: 'text-2xl font-black' }, tr.name),
                        e('p', { className: 'text-xs text-slate-500 uppercase font-black tracking-widest' }, `${t.cycleNum} ${tr.cycle || 1} • ${tr.done}/${tr.total} ${t.progress}`)
                      ]),
                      e('div', { className: 'flex gap-3' }, [
                        e('button', { 
                          onClick: () => setShowingHistory(tr),
                          className: `p-4 rounded-xl border transition-all ${isDark ? 'border-white/10' : 'border-slate-200 hover:bg-slate-50'}`
                        }, e(Icon, { name: 'History', className: 'w-5 h-5 opacity-60' })),
                        e('button', { 
                          onClick: () => setRenewing(tr),
                          className: `px-7 py-4 rounded-xl font-black text-[11px] uppercase border transition-all ${isDark ? 'border-white/10 text-indigo-400' : 'border-slate-200 text-indigo-600'}`
                        }, t.renew),
                        e('button', { 
                          onClick: () => { if(window.confirm(t.confirmDel)) { setTrainees(prev => prev.filter(x => x.id !== tr.id)); } },
                          className: 'p-4 bg-rose-500/10 text-rose-500 rounded-xl active:scale-90 transition-all hover:bg-rose-500/20' 
                        }, e(Icon, { name: 'Trash2' }))
                      ])
                    ])
                  ])))
                ]),

                view === 'logs' && e('div', { className: 'space-y-8 pb-10' }, [
                  e('div', { className: 'flex flex-col md:flex-row md:items-center justify-between gap-6' }, [
                    e('h2', { className: 'text-4xl font-black italic uppercase' }, t.logs),
                    e('div', { className: 'relative flex-1 max-w-sm' }, [
                      e(Icon, { name: 'Search', className: 'absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 opacity-40' }),
                      e('input', { 
                        placeholder: t.searchLogs, 
                        value: logSearch,
                        onChange: (ev) => setLogSearch(ev.target.value), 
                        className: `w-full rounded-2xl pl-12 pr-6 py-4 text-sm outline-none border transition-all ${isDark ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200 shadow-sm focus:border-indigo-500'}` 
                      })
                    ])
                  ]),
                  e('div', { className: `rounded-[2.5rem] overflow-hidden border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                    e('div', { className: 'overflow-x-auto' }, [
                        e('table', { className: 'w-full text-left border-collapse min-w-[700px]' }, [
                            e('thead', { className: isDark ? 'bg-white/5' : 'bg-slate-50' }, e('tr', {}, [
                                e('th', { className: 'p-6 text-[11px] font-black uppercase text-slate-500 tracking-widest' }, t.traineeLabel),
                                e('th', { className: 'p-6 text-[11px] font-black uppercase text-slate-500 tracking-widest' }, t.date),
                                e('th', { className: 'p-6 text-[11px] font-black uppercase text-slate-500 tracking-widest' }, t.progress),
                                e('th', { className: 'p-6 text-center text-[11px] font-black uppercase text-slate-500 tracking-widest' }, 'Sign'),
                                e('th', { className: 'p-6 w-24' }, '')
                            ])),
                            e('tbody', {}, filteredLogs.length > 0 ? filteredLogs.map(l => e('tr', { key: l.id, className: `border-t ${isDark ? 'border-white/5' : 'border-slate-100'} hover:bg-indigo-500/5 transition-colors` }, [
                                e('td', { className: 'p-6 text-sm font-black' }, l.name),
                                e('td', { className: 'p-6 text-xs text-slate-500 font-medium' }, new Date(l.date).toLocaleString()),
                                e('td', { className: 'p-6 text-xs text-indigo-500 font-black' }, `${t.cycleNum} ${l.cycle} | ${l.progress}`),
                                e('td', { className: 'p-6 text-center' }, e('img', { src: l.sig, className: `h-10 mx-auto opacity-80 ${isDark ? 'invert' : ''}` })),
                                e('td', { className: 'p-6 text-center' }, e('button', { 
                                    onClick: () => deleteLog(l.id),
                                    className: 'p-4 text-rose-500 hover:bg-rose-500/10 rounded-2xl transition-all active:scale-90 border border-transparent hover:border-rose-500/20'
                                }, e(Icon, { name: 'XCircle', className: 'w-7 h-7' })))
                            ])) : e('tr', {}, e('td', { colSpan: 5, className: 'p-12 text-center text-slate-500 font-bold' }, t.noHistory)))
                        ])
                    ])
                  ])
                ])
              ])
            ]),

            // Language Selector Modal
            isLangOpen && e('div', { className: 'fixed inset-0 z-[300] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-sm p-8 border rounded-[3rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-2xl font-black italic uppercase mb-6 text-center' }, t.lang),
                e('div', { className: 'grid grid-cols-1 gap-2' }, Object.keys(translations).map(k => e('button', {
                  key: k,
                  onClick: () => { setLang(k); setIsLangOpen(false); },
                  className: `w-full py-4 px-6 rounded-2xl font-bold transition-all text-left flex justify-between items-center ${lang === k ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30' : (isDark ? 'hover:bg-white/5' : 'hover:bg-slate-50')}`
                }, [
                  translations[k].langName,
                  lang === k && e(Icon, { name: 'Check', className: 'w-4 h-4' })
                ]))),
                e('button', { onClick: () => setIsLangOpen(false), className: 'w-full py-4 text-slate-500 font-bold uppercase text-[10px] mt-4 active:text-indigo-500' }, t.cancel)
              ])
            ]),

            // Mobile Navigation Bar
            e('nav', { className: `lg:hidden fixed bottom-0 left-0 right-0 h-24 border-t flex items-center justify-around z-[100] backdrop-blur-3xl pb-[env(safe-area-inset-bottom)] ${isDark ? 'bg-slate-950/90 border-white/5' : 'bg-white/90 border-slate-200'} shadow-[0_-8px_30px_rgb(0,0,0,0.12)]` }, [
              e('button', { onClick: () => setView('dash'), className: `flex flex-col items-center gap-1 p-2 flex-1 transition-all active:scale-95 ${view === 'dash' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'LayoutDashboard' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.dash)]),
              e('button', { onClick: () => setView('att'), className: `flex flex-col items-center gap-1 p-2 flex-1 transition-all active:scale-95 ${view === 'att' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'CheckCircle2' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.att)]),
              e('button', { onClick: () => setView('manage'), className: `flex flex-col items-center gap-1 p-2 flex-1 transition-all active:scale-95 ${view === 'manage' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'Users2' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.manage)]),
              e('button', { onClick: () => setView('logs'), className: `flex flex-col items-center gap-1 p-2 flex-1 transition-all active:scale-95 ${view === 'logs' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'History' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.logs)])
            ]),

            // MODALS: Signature
            activeUser && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-2xl p-10 lg:p-14 border rounded-[4rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-4xl font-black italic uppercase mb-2' }, activeUser.name),
                e('p', { className: 'text-[11px] text-slate-500 uppercase font-black tracking-widest mb-10' }, `${t.cycleNum} ${activeUser.cycle || 1} • ${activeUser.done + 1} / ${activeUser.total}`),
                e(SignaturePad, { t, theme, onCancel: () => setActiveUser(null), onSave: (sig) => {
                  const logId = Date.now();
                  const log = { 
                    id: logId, 
                    traineeId: activeUser.id,
                    name: activeUser.name, 
                    date: new Date().toISOString(), 
                    sig, 
                    cycle: activeUser.cycle || 1, 
                    progress: `${activeUser.done + 1}/${activeUser.total}` 
                  };
                  
                  setLogs(prev => [log, ...prev]);
                  setTrainees(prev => prev.map(x => x.id === activeUser.id ? { ...x, done: x.done + 1 } : x));
                  setActiveUser(null);
                }})
              ])
            ]),

            // MODALS: Add Trainee
            isAdding && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-lg p-10 border rounded-[3.5rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-3xl font-black italic uppercase mb-10 text-center' }, t.add),
                e('div', { className: 'space-y-6' }, [
                  e('div', {}, [
                    e('label', { className: 'text-[10px] font-black uppercase text-slate-500 mb-2 block' }, t.traineeLabel),
                    e('input', { id: 'in-name', placeholder: 'e.g. Sam', className: `w-full p-5 rounded-2xl outline-none font-bold border transition-all ${isDark ? 'bg-white/5 border-white/5 focus:border-indigo-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}` })
                  ]),
                  e('div', {}, [
                    e('label', { className: 'text-[10px] font-black uppercase text-slate-500 mb-2 block' }, t.lessons),
                    e('input', { id: 'in-total', type: 'number', defaultValue: 10, className: `w-full p-5 rounded-2xl outline-none font-bold border transition-all ${isDark ? 'bg-white/5 border-white/5 focus:border-indigo-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}` })
                  ]),
                  e('button', { onClick: () => {
                    const n = document.getElementById('in-name').value;
                    const tot = parseInt(document.getElementById('in-total').value) || 10;
                    if (!n) return;
                    setTrainees(prev => [...prev, { id: Date.now(), name: n, done: 0, total: tot, cycle: 1, history: [] }]);
                    setIsAdding(false);
                  }, className: 'w-full py-6 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl mt-6 active:scale-95 transition-all shadow-indigo-600/20' }, t.add),
                  e('button', { onClick: () => setIsAdding(false), className: 'w-full py-4 text-slate-500 font-bold uppercase text-[10px] active:text-indigo-500' }, t.cancel)
                ])
              ])
            ]),

            // MODALS: Renew Cycle
            renewing && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-lg p-10 border rounded-[3.5rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-3xl font-black italic uppercase mb-2 text-center' }, t.renew),
                e('p', { className: 'text-[10px] text-slate-500 font-black uppercase tracking-widest mb-10 text-center' }, `${renewing.name} | Cycle ${renewing.cycle} -> ${renewing.cycle + 1}`),
                e('div', { className: 'space-y-6' }, [
                  e('div', {}, [
                    e('label', { className: 'text-[10px] font-black uppercase text-slate-500 mb-2 block' }, t.totalSessions),
                    e('input', { id: 're-total', type: 'number', defaultValue: renewing.total, className: `w-full p-5 rounded-2xl outline-none font-bold border transition-all ${isDark ? 'bg-white/5 border-white/5 focus:border-indigo-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}` })
                  ]),
                  e('button', { onClick: () => {
                    const tot = parseInt(document.getElementById('re-total').value) || 10;
                    setTrainees(prev => prev.map(tr => {
                      if (tr.id === renewing.id) {
                        return { ...tr, done: 0, total: tot, cycle: (tr.cycle || 1) + 1, history: [...(tr.history || []), { date: new Date().toLocaleDateString(), cycle: tr.cycle || 1, result: `${tr.done}/${tr.total}` }] };
                      }
                      return tr;
                    }));
                    setRenewing(null);
                  }, className: 'w-full py-6 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl mt-6 active:scale-95 transition-all' }, t.save),
                  e('button', { onClick: () => setRenewing(null), className: 'w-full py-4 text-slate-500 font-bold uppercase text-[10px] active:text-indigo-500' }, t.cancel)
                ])
              ])
            ]),

            // MODALS: History View
            showingHistory && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
                e('div', { className: `w-full max-w-xl p-10 border rounded-[4rem] shadow-2xl flex flex-col max-h-[80vh] ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                  e('div', { className: 'flex justify-between items-start mb-8' }, [
                    e('div', {}, [
                      e('h3', { className: 'text-4xl font-black italic uppercase mb-2' }, showingHistory.name),
                      e('p', { className: 'text-[11px] text-slate-500 uppercase font-black tracking-widest' }, t.history)
                    ]),
                    e('button', { onClick: () => setShowingHistory(null), className: 'p-3 active:bg-slate-500/10 rounded-full' }, e(Icon, { name: 'X' }))
                  ]),
                  e('div', { className: 'flex-1 overflow-y-auto space-y-4 pr-2' }, 
                     (showingHistory.history && showingHistory.history.length > 0) ? showingHistory.history.map((h, i) => 
                       e('div', { key: i, className: `p-6 rounded-3xl border flex justify-between items-center ${isDark ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100 shadow-sm'}` }, [
                         e('div', {}, [
                           e('p', { className: 'text-[10px] font-black text-slate-500 uppercase mb-1' }, `${t.cycleNum} ${h.cycle}`),
                           e('p', { className: 'text-lg font-black' }, h.date)
                         ]),
                         e('p', { className: 'text-2xl font-black text-indigo-500' }, h.result)
                       ])
                     ) : e('p', { className: 'text-slate-500 text-center py-10 font-bold' }, t.noHistory)
                  ),
                  e('button', { onClick: () => setShowingHistory(null), className: 'w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase mt-8 shadow-xl active:scale-95 shadow-indigo-600/20' }, t.done)
                ])
            ])
          ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>