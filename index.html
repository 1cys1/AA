<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FitCheck Pro | Coach Suite</title>
    
    <meta name="theme-color" content="#020617">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://ui-avatars.com/api/?name=FC&background=6366f1&color=fff&size=180&bold=true">
    
    <script src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
          --sat: env(safe-area-inset-top); 
          --sar: env(safe-area-inset-right); 
          --sab: env(safe-area-inset-bottom); 
          --sal: env(safe-area-inset-left); 
        }
        body { 
          font-family: 'Inter', sans-serif; 
          -webkit-tap-highlight-color: transparent; 
          overscroll-behavior-y: contain; 
          margin: 0; 
          user-select: none; 
          overflow: hidden;
          transition: background-color 0.3s ease, color 0.3s ease;
        }
        #root { 
          height: 100vh; 
          width: 100vw; 
          overflow: hidden; 
          display: flex; 
          flex-direction: column; 
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.4); border-radius: 10px; }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-950 text-white">
    <div id="root"></div>

    <script>
        const e = React.createElement;
        const { useState, useEffect, useRef } = React;

        const translations = {
          en: {
            dash: "Dashboard", att: "Attendance", manage: "Trainees", logs: "Check-ins",
            welcome: "Welcome, Coach", total: "Total Students", today: "Today's Lessons",
            search: "Search students...", checkIn: "Lesson Check-In", add: "New Student",
            name: "Full Name", lessons: "Lesson Total", sign: "Confirm Signature",
            reset: "Reset", cancel: "Cancel", verify: "Verification Signature",
            done: "Success", del: "Delete", confirmDel: "Erase all student data?",
            lang: "Language", theme: "Theme", cycle: "Cycle", renew: "Start New Cycle",
            pkgInfo: "Lesson Progress", totalSessions: "Lesson Total", cycleNum: "Cycle",
            save: "Start Cycle", active: "Active Cycles", date: "Date", progress: "Progress",
            history: "Cycle History", noHistory: "No previous cycles recorded."
          },
          zh: {
            dash: "仪表盘", att: "签到管理", manage: "学员管理", logs: "签到详情",
            welcome: "欢迎回来，教练", total: "学员总数", today: "今日已签",
            search: "搜索姓名...", checkIn: "课时核销", add: "添加学员",
            name: "学员姓名", lessons: "购买课时", sign: "确认签名",
            reset: "重置", cancel: "取消", verify: "身份核验",
            done: "签到成功", del: "删除", confirmDel: "确定删除该学员及所有历史记录吗？",
            lang: "语言切换", theme: "显示模式", cycle: "期数", renew: "开启新一期",
            pkgInfo: "课时进度", totalSessions: "总课时数", cycleNum: "第 # 期",
            save: "开启新期", active: "活跃学员", date: "日期", progress: "进度",
            history: "历史期数记录", noHistory: "暂无历史期数记录"
          }
        };

        const db = {
          KEYS: { TR: 'fit_tr_v6', LG: 'fit_lg_v6', TM: 'fit_theme_v6' },
          get: (k) => JSON.parse(localStorage.getItem(k) || '[]'),
          set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
        };

        const Icon = ({ name, className }) => {
          const iconName = name.charAt(0).toLowerCase() + name.slice(1);
          const iconData = window.lucide.icons[iconName] || window.lucide.icons[name];
          if (!iconData) return e('span', { className });
          const [tag, attrs, children] = iconData;
          return e(tag, { ...attrs, className: className || 'w-6 h-6', stroke: 'currentColor', key: name }, 
            children.map((child, i) => e(child[0], { ...child[1], key: i }))
          );
        };

        const SignaturePad = ({ onSave, onCancel, t, theme }) => {
          const canvasRef = useRef(null);
          const [isDrawing, setIsDrawing] = useState(false);
          const isDark = theme === 'dark';

          useEffect(() => {
            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            ctx.lineWidth = 4; ctx.lineCap = 'round'; 
            ctx.strokeStyle = '#6366f1';
          }, []);

          const getPos = (ev) => {
            const rect = canvasRef.current.getBoundingClientRect();
            const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
            const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
          };

          const start = (ev) => {
            if (ev.cancelable) ev.preventDefault();
            const { x, y } = getPos(ev);
            const ctx = canvasRef.current.getContext('2d');
            ctx.beginPath(); ctx.moveTo(x, y);
            setIsDrawing(true);
          };

          const move = (ev) => {
            if (!isDrawing) return;
            if (ev.cancelable) ev.preventDefault();
            const { x, y } = getPos(ev);
            const ctx = canvasRef.current.getContext('2d');
            ctx.lineTo(x, y); ctx.stroke();
          };

          return e('div', { className: 'space-y-6' }, [
            e('div', { className: `relative h-72 border-2 rounded-[2.5rem] overflow-hidden ${isDark ? 'border-white/10 bg-black/40' : 'border-slate-200 bg-white shadow-inner'}` }, [
              e('canvas', {
                ref: canvasRef,
                onMouseDown: start, onMouseMove: move, onMouseUp: () => setIsDrawing(false),
                onTouchStart: start, onTouchMove: move, onTouchEnd: () => setIsDrawing(false),
                className: 'w-full h-full'
              }),
              e('div', { className: `absolute top-6 right-8 text-[9px] font-black uppercase tracking-widest ${isDark ? 'opacity-20' : 'opacity-40 text-slate-400'}` }, t.verify)
            ]),
            e('div', { className: 'flex gap-4' }, [
              e('button', { onClick: () => canvasRef.current.getContext('2d').clearRect(0,0,999,999), className: `flex-1 py-5 rounded-2xl font-bold text-[11px] uppercase ${isDark ? 'bg-white/5 border border-white/5' : 'bg-slate-100 border border-slate-200'}` }, t.reset),
              e('button', { onClick: onCancel, className: `flex-1 py-5 rounded-2xl font-bold text-[11px] uppercase ${isDark ? 'bg-white/5 border border-white/5' : 'bg-slate-100 border border-slate-200'}` }, t.cancel),
              e('button', { onClick: () => onSave(canvasRef.current.toDataURL()), className: 'flex-[2] py-5 bg-indigo-600 text-white rounded-2xl font-bold text-[11px] uppercase shadow-xl shadow-indigo-600/20 active:scale-95 transition-transform' }, t.sign)
            ])
          ]);
        };

        const App = () => {
          const [lang, setLang] = useState('en');
          const [theme, setTheme] = useState(() => localStorage.getItem(db.KEYS.TM) || 'dark');
          const [view, setView] = useState('dash');
          const [trainees, setTrainees] = useState(() => db.get(db.KEYS.TR));
          const [logs, setLogs] = useState(() => db.get(db.KEYS.LG));
          const [search, setSearch] = useState('');
          
          const [activeUser, setActiveUser] = useState(null);
          const [isAdding, setIsAdding] = useState(false);
          const [renewing, setRenewing] = useState(null);
          const [showingHistory, setShowingHistory] = useState(null);

          const t = translations[lang];
          const isDark = theme === 'dark';

          useEffect(() => {
            document.body.className = isDark ? 'bg-slate-950 text-white' : 'bg-slate-50 text-slate-900';
            localStorage.setItem(db.KEYS.TM, theme);
          }, [theme]);

          const filtered = trainees.filter(tr => tr.name.toLowerCase().includes(search.toLowerCase()));

          const NavBtn = (id, icon, label) => e('button', {
            onClick: () => setView(id),
            className: `flex items-center gap-4 px-6 py-5 rounded-2xl transition-all ${view === id 
              ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-600/30' 
              : (isDark ? 'text-slate-500 hover:bg-white/5' : 'text-slate-400 hover:bg-slate-200/50')}`
          }, [
            e(Icon, { name: icon, className: 'w-5 h-5' }),
            e('span', { className: 'font-black uppercase text-[10px] tracking-widest' }, label)
          ]);

          const stats = {
            total: trainees.length,
            today: logs.filter(l => new Date(l.date).toDateString() === new Date().toDateString()).length,
            active: trainees.filter(tr => tr.done < tr.total).length
          };

          return e('div', { className: 'flex h-screen flex-col lg:flex-row overflow-hidden' }, [
            // Sidebar
            e('nav', { className: `hidden lg:flex w-80 flex-col gap-10 p-10 border-r ${isDark ? 'border-white/5' : 'border-slate-200 shadow-xl'}` }, [
              e('div', { className: 'flex items-center gap-4' }, [
                e('div', { className: 'p-3 bg-indigo-600 rounded-2xl shadow-lg shadow-indigo-600/30' }, e(Icon, { name: 'Activity', className: 'w-7 h-7 text-white' })),
                e('h1', { className: 'text-2xl font-black italic uppercase tracking-tight' }, 'FitCheck')
              ]),
              e('div', { className: 'flex flex-col gap-2' }, [
                NavBtn('dash', 'LayoutDashboard', t.dash),
                NavBtn('att', 'CheckCircle2', t.att),
                NavBtn('manage', 'Users2', t.manage),
                NavBtn('logs', 'History', t.logs)
              ]),
              e('div', { className: 'mt-auto space-y-3' }, [
                e('button', { 
                  onClick: () => setTheme(isDark ? 'light' : 'dark'),
                  className: `w-full flex justify-between p-4 border rounded-xl text-[10px] font-black uppercase transition-colors ${isDark ? 'border-white/5 hover:bg-white/5' : 'border-slate-200 hover:bg-slate-100'}`
                }, [ e('span', {}, t.theme), e(Icon, { name: isDark ? 'Moon' : 'Sun', className: 'w-4 h-4' }) ]),
                e('button', { 
                  onClick: () => setLang(lang === 'en' ? 'zh' : 'en'), 
                  className: `w-full flex justify-between p-4 border rounded-xl text-[10px] font-black uppercase transition-colors ${isDark ? 'border-white/5 hover:bg-white/5' : 'border-slate-200 hover:bg-slate-100'}`
                }, [ e('span', {}, t.lang), e('span', {}, lang.toUpperCase()) ])
              ])
            ]),

            // Mobile Header
            e('header', { className: `lg:hidden flex justify-between items-center p-6 border-b ${isDark ? 'border-white/5' : 'border-slate-200 bg-white/50 backdrop-blur-md'}` }, [
              e('h1', { className: 'font-black italic uppercase text-lg' }, 'FitCheck'),
              e('div', { className: 'flex gap-6 items-center' }, [
                e('button', { onClick: () => setTheme(isDark ? 'light' : 'dark') }, e(Icon, { name: isDark ? 'Moon' : 'Sun', className: 'w-5 h-5 opacity-70' })),
                e('button', { onClick: () => setLang(lang === 'en' ? 'zh' : 'en'), className: 'font-black text-xs opacity-70' }, lang.toUpperCase())
              ])
            ]),

            // Main Content
            e('main', { className: 'flex-1 overflow-y-auto p-6 lg:p-14 pb-32' }, [
              e('div', { className: 'max-w-5xl mx-auto space-y-12 animate-fade-in' }, [
                
                // Dashboard
                view === 'dash' && e('div', { className: 'space-y-12' }, [
                  e('div', {}, [
                    e('h2', { className: 'text-5xl font-black mb-2' }, t.welcome),
                    e('p', { className: 'text-slate-500 font-medium' }, 'Performance and attendance summary.')
                  ]),
                  e('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' }, [
                    e('div', { className: `p-8 rounded-[3rem] border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('p', { className: 'text-[10px] font-black uppercase text-slate-500 tracking-widest' }, t.total),
                      e('p', { className: 'text-4xl font-black mt-3' }, stats.total)
                    ]),
                    e('div', { className: `p-8 rounded-[3rem] border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('p', { className: 'text-[10px] font-black uppercase text-slate-500 tracking-widest' }, t.today),
                      e('p', { className: 'text-4xl font-black mt-3 text-indigo-500' }, stats.today)
                    ]),
                    e('div', { className: `p-8 rounded-[3rem] border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('p', { className: 'text-[10px] font-black uppercase text-slate-500 tracking-widest' }, t.active),
                      e('p', { className: 'text-4xl font-black mt-3' }, stats.active)
                    ])
                  ])
                ]),

                // Attendance
                view === 'att' && e('div', { className: 'space-y-8' }, [
                  e('div', { className: 'flex flex-col md:flex-row md:items-center justify-between gap-6' }, [
                    e('h2', { className: 'text-4xl font-black italic uppercase' }, t.att),
                    e('div', { className: 'relative flex-1 max-w-sm' }, [
                      e(Icon, { name: 'Search', className: 'absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 opacity-40' }),
                      e('input', { 
                        placeholder: t.search, 
                        onChange: (ev) => setSearch(ev.target.value), 
                        className: `w-full rounded-2xl pl-12 pr-6 py-4 text-sm outline-none border transition-all ${isDark ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200 shadow-sm'}` 
                      })
                    ])
                  ]),
                  e('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' }, filtered.map(tr => {
                    const progress = Math.min((tr.done / tr.total) * 100, 100);
                    const isCompleted = tr.done >= tr.total;
                    return e('div', { key: tr.id, className: `p-7 border rounded-[2.5rem] flex flex-col gap-5 ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                      e('div', { className: 'flex justify-between items-start' }, [
                        e('div', {}, [
                          e('p', { className: 'font-black text-xl' }, tr.name),
                          e('div', { className: 'flex gap-3 items-center mt-2' }, [
                             e('span', { className: 'text-[10px] font-black text-indigo-500 uppercase px-3 py-1 bg-indigo-500/10 rounded-full' }, `${t.cycle} ${tr.cycle || 1}`),
                             e('span', { className: 'text-[10px] font-black text-slate-500 uppercase' }, `${tr.done} / ${tr.total}`)
                          ])
                        ]),
                        e('button', { 
                          onClick: () => setActiveUser(tr), 
                          disabled: isCompleted,
                          className: `w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transition-all active:scale-90 ${isCompleted ? 'opacity-20 bg-slate-500' : 'bg-indigo-600 text-white'}` 
                        }, e(Icon, { name: 'Check', className: 'w-7 h-7' }))
                      ]),
                      e('div', { className: `w-full h-2 rounded-full overflow-hidden ${isDark ? 'bg-white/5' : 'bg-slate-100'}` }, [
                        e('div', { className: `h-full transition-all duration-700 ${isCompleted ? 'bg-emerald-500' : 'bg-indigo-500'}`, style: { width: `${progress}%` } })
                      ])
                    ]);
                  }))
                ]),

                // Trainees (Management)
                view === 'manage' && e('div', { className: 'space-y-8' }, [
                  e('div', { className: 'flex justify-between items-center' }, [
                    e('h2', { className: 'text-4xl font-black italic uppercase' }, t.manage),
                    e('button', { onClick: () => setIsAdding(true), className: 'px-8 py-5 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase shadow-xl active:scale-95 transition-transform' }, t.add)
                  ]),
                  e('div', { className: 'space-y-4' }, trainees.map(tr => e('div', { key: tr.id, className: `p-8 border rounded-[3rem] flex flex-col gap-6 transition-colors ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                    e('div', { className: 'flex flex-col md:flex-row md:items-center justify-between gap-4' }, [
                      e('div', { className: 'flex flex-col gap-1' }, [
                        e('p', { className: 'text-2xl font-black' }, tr.name),
                        e('p', { className: 'text-xs text-slate-500 uppercase font-black tracking-widest' }, `${t.cycleNum} ${tr.cycle || 1} • ${tr.done}/${tr.total} ${t.lessons}`)
                      ]),
                      e('div', { className: 'flex gap-3' }, [
                        e('button', { 
                          onClick: () => setShowingHistory(tr),
                          className: `p-4 rounded-xl border transition-all ${isDark ? 'border-white/10 hover:bg-white/5' : 'border-slate-200 hover:bg-slate-50'}`
                        }, e(Icon, { name: 'History', className: 'w-5 h-5 opacity-60' })),
                        e('button', { 
                          onClick: () => setRenewing(tr),
                          className: `px-7 py-4 rounded-xl font-black text-[11px] uppercase border transition-all ${isDark ? 'border-white/10 hover:bg-white/5 text-indigo-400' : 'border-slate-200 hover:bg-slate-50 text-indigo-600'}`
                        }, t.renew),
                        e('button', { 
                          onClick: () => { if(confirm(t.confirmDel)) { const n = trainees.filter(x => x.id !== tr.id); setTrainees(n); db.set(db.KEYS.TR, n); } },
                          className: 'p-4 bg-rose-500/10 text-rose-500 rounded-xl hover:bg-rose-500/20 active:scale-90 transition-all' 
                        }, e(Icon, { name: 'Trash2' }))
                      ])
                    ]),
                    // History Record Sample (Inline if needed, but we have a modal now)
                    tr.history && tr.history.length > 0 && e('div', { className: `mt-2 p-4 rounded-2xl ${isDark ? 'bg-black/20' : 'bg-slate-50/50'}` }, [
                        e('p', { className: 'text-[9px] font-black uppercase text-slate-500 mb-2' }, `${t.history} (Last: ${tr.history[tr.history.length-1].date})`),
                        e('div', { className: 'flex gap-2 overflow-x-auto pb-1' }, tr.history.slice(-3).map((h, i) => 
                            e('span', { key: i, className: 'text-[10px] font-bold whitespace-nowrap bg-indigo-500/10 px-3 py-1 rounded-full text-indigo-500' }, `${h.date}: ${h.result}`)
                        ))
                    ])
                  ])))
                ]),

                // Detailed History (Individual Logs)
                view === 'logs' && e('div', { className: 'space-y-8' }, [
                  e('h2', { className: 'text-4xl font-black italic uppercase' }, t.logs),
                  e('div', { className: `rounded-[2.5rem] overflow-hidden border ${isDark ? 'bg-white/5 border-white/5' : 'bg-white border-slate-100 shadow-sm'}` }, [
                    e('table', { className: 'w-full text-left border-collapse' }, [
                      e('thead', { className: isDark ? 'bg-white/5' : 'bg-slate-50' }, e('tr', {}, [
                        e('th', { className: 'p-6 text-[11px] font-black uppercase text-slate-500 tracking-widest' }, t.name),
                        e('th', { className: 'p-6 text-[11px] font-black uppercase text-slate-500 tracking-widest' }, t.date),
                        e('th', { className: 'p-6 text-[11px] font-black uppercase text-slate-500 tracking-widest' }, t.progress),
                        e('th', { className: 'p-6 text-center text-[11px] font-black uppercase text-slate-500 tracking-widest' }, 'Sign')
                      ])),
                      e('tbody', {}, logs.map(l => e('tr', { key: l.id, className: `border-t ${isDark ? 'border-white/5' : 'border-slate-100'}` }, [
                        e('td', { className: 'p-6 text-sm font-black' }, l.name),
                        e('td', { className: 'p-6 text-xs text-slate-500 font-medium' }, new Date(l.date).toLocaleString()),
                        e('td', { className: 'p-6 text-xs text-indigo-500 font-black' }, `${t.cycle} ${l.cycle} | ${l.progress}`),
                        e('td', { className: 'p-6 text-center' }, e('img', { src: l.sig, className: `h-8 mx-auto opacity-70 ${isDark ? 'invert' : ''}` }))
                      ])))
                    ])
                  ])
                ])
              ])
            ]),

            // Mobile Navigation
            e('nav', { className: `lg:hidden fixed bottom-0 left-0 right-0 h-24 border-t flex items-center justify-around z-[100] backdrop-blur-2xl ${isDark ? 'bg-slate-950/90 border-white/5' : 'bg-white/90 border-slate-200'}` }, [
              e('button', { onClick: () => setView('dash'), className: `flex flex-col items-center gap-1 ${view === 'dash' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'LayoutDashboard' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.dash)]),
              e('button', { onClick: () => setView('att'), className: `flex flex-col items-center gap-1 ${view === 'att' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'CheckCircle2' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.att)]),
              e('button', { onClick: () => setView('manage'), className: `flex flex-col items-center gap-1 ${view === 'manage' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'Users2' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.manage)]),
              e('button', { onClick: () => setView('logs'), className: `flex flex-col items-center gap-1 ${view === 'logs' ? 'text-indigo-500' : 'text-slate-400'}` }, [e(Icon, { name: 'History' }), e('span', { className: 'text-[9px] font-black uppercase' }, t.logs)])
            ]),

            // --- MODALS ---

            // Cycle History Modal
            showingHistory && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-xl p-12 border rounded-[4rem] shadow-2xl overflow-hidden flex flex-col max-h-[80vh] ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('div', { className: 'flex justify-between items-start mb-8' }, [
                  e('div', {}, [
                    e('h3', { className: 'text-4xl font-black italic uppercase mb-2' }, showingHistory.name),
                    e('p', { className: 'text-[11px] text-slate-500 uppercase font-black tracking-widest' }, t.history)
                  ]),
                  e('button', { onClick: () => setShowingHistory(null), className: 'p-3 rounded-full hover:bg-slate-500/10 transition-colors' }, e(Icon, { name: 'X' }))
                ]),
                e('div', { className: 'flex-1 overflow-y-auto pr-2 space-y-4' }, 
                   (showingHistory.history && showingHistory.history.length > 0) ? showingHistory.history.map((h, i) => 
                     e('div', { key: i, className: `p-6 rounded-3xl border flex justify-between items-center ${isDark ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}` }, [
                       e('div', {}, [
                         e('p', { className: 'text-[10px] font-black text-slate-500 uppercase mb-1' }, `${t.cycleNum} ${h.cycle}`),
                         e('p', { className: 'text-lg font-black' }, h.date)
                       ]),
                       e('p', { className: 'text-2xl font-black text-indigo-500' }, h.result)
                     ])
                   ) : e('p', { className: 'text-slate-500 text-center py-10 font-bold' }, t.noHistory)
                ),
                e('button', { onClick: () => setShowingHistory(null), className: 'w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase mt-8' }, t.done)
              ])
            ]),

            // Signature Capture Modal
            activeUser && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-2xl p-12 border rounded-[4rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-4xl font-black italic uppercase mb-2' }, activeUser.name),
                e('p', { className: 'text-[11px] text-slate-500 uppercase font-black tracking-[0.2em] mb-10' }, `${t.cycle} ${activeUser.cycle || 1} • ${t.pkgInfo}: ${activeUser.done + 1} / ${activeUser.total}`),
                e(SignaturePad, { t, theme, onCancel: () => setActiveUser(null), onSave: (sig) => {
                  const log = { 
                    id: Date.now(), 
                    name: activeUser.name, 
                    date: new Date().toISOString(), 
                    sig, 
                    cycle: activeUser.cycle || 1, 
                    progress: `${activeUser.done + 1}/${activeUser.total}` 
                  };
                  const nL = [log, ...logs]; setLogs(nL); db.set(db.KEYS.LG, nL);
                  const nT = trainees.map(x => x.id === activeUser.id ? { ...x, done: x.done + 1 } : x);
                  setTrainees(nT); db.set(db.KEYS.TR, nT);
                  setActiveUser(null);
                }})
              ])
            ]),

            // Add Trainee Modal
            isAdding && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-lg p-12 border rounded-[3.5rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-3xl font-black italic uppercase mb-10' }, t.add),
                e('div', { className: 'space-y-6' }, [
                  e('div', {}, [
                    e('label', { className: 'text-[10px] font-black uppercase text-slate-500 mb-2 block' }, t.name),
                    e('input', { id: 'in-name', placeholder: 'e.g. Sam', className: `w-full p-5 rounded-2xl outline-none font-bold border ${isDark ? 'bg-white/5 border-white/5 focus:border-indigo-500/50' : 'bg-slate-50 border-slate-100 focus:border-indigo-500/50'}` })
                  ]),
                  e('div', {}, [
                    e('label', { className: 'text-[10px] font-black uppercase text-slate-500 mb-2 block' }, t.lessons),
                    e('input', { id: 'in-total', type: 'number', defaultValue: 10, className: `w-full p-5 rounded-2xl outline-none font-bold border ${isDark ? 'bg-white/5 border-white/5 focus:border-indigo-500/50' : 'bg-slate-50 border-slate-100 focus:border-indigo-500/50'}` })
                  ]),
                  e('button', { onClick: () => {
                    const n = document.getElementById('in-name').value;
                    const tot = parseInt(document.getElementById('in-total').value) || 10;
                    if (!n) return;
                    const next = [...trainees, { id: Date.now(), name: n, done: 0, total: tot, cycle: 1, history: [] }];
                    setTrainees(next); db.set(db.KEYS.TR, next); setIsAdding(false);
                  }, className: 'w-full py-6 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl mt-6 active:scale-95 transition-all' }, t.add),
                  e('button', { onClick: () => setIsAdding(false), className: 'w-full py-4 text-slate-500 font-bold uppercase text-[10px]' }, t.cancel)
                ])
              ])
            ]),

            // Renew/Cycle Start Modal
            renewing && e('div', { className: 'fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6' }, [
              e('div', { className: `w-full max-w-lg p-12 border rounded-[3.5rem] shadow-2xl ${isDark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}` }, [
                e('h3', { className: 'text-3xl font-black italic uppercase mb-2' }, t.renew),
                e('p', { className: 'text-[10px] text-slate-500 font-black uppercase tracking-widest mb-10' }, `${renewing.name} | Cycle ${renewing.cycle} -> ${renewing.cycle + 1}`),
                e('div', { className: 'space-y-6' }, [
                  e('div', {}, [
                    e('label', { className: 'text-[10px] font-black uppercase text-slate-500 mb-2 block' }, t.totalSessions),
                    e('input', { id: 're-total', type: 'number', defaultValue: renewing.total, className: `w-full p-5 rounded-2xl outline-none font-bold border ${isDark ? 'bg-white/5 border-white/5 focus:border-indigo-500/50' : 'bg-slate-50 border-slate-100 focus:border-indigo-500/50'}` })
                  ]),
                  e('button', { onClick: () => {
                    const tot = parseInt(document.getElementById('re-total').value) || 10;
                    const next = trainees.map(tr => {
                      if (tr.id === renewing.id) {
                        const historyItem = {
                          date: new Date().toLocaleDateString(),
                          cycle: tr.cycle || 1,
                          result: `${tr.done}/${tr.total}`
                        };
                        return {
                          ...tr,
                          done: 0,
                          total: tot,
                          cycle: (tr.cycle || 1) + 1,
                          history: [...(tr.history || []), historyItem]
                        };
                      }
                      return tr;
                    });
                    setTrainees(next); db.set(db.KEYS.TR, next); setRenewing(null);
                  }, className: 'w-full py-6 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl mt-6 active:scale-95 transition-all' }, t.save),
                  e('button', { onClick: () => setRenewing(null), className: 'w-full py-4 text-slate-500 font-bold uppercase text-[10px]' }, t.cancel)
                ])
              ])
            ])
          ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>